<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Movie Suggestor</title>
</head>
<body>

<!-- Header -->
<header>
    <h1>Movie Suggestor</h1>
    <!-- Login and Signup Links -->
    <div>
        <div th:if="${LoggedInUser != null}">
            <a href="/loggedin">My Profile</a>
            |
            <form th:action="@{/logout}" method="post" style="display:inline;">
                <button type="submit">Log out</button>
            </form>
        </div>
        <div th:if="${LoggedInUser == null}">
            <a href="/login">Log in</a>
            |
            <a href="/signup">Sign up</a>
        </div>
    </div>
</header>

<hr/>

<!-- Featured Movie -->
<section>
    <h2>Featured Movie</h2>
    <div th:if="${tmdbMovie != null}">
        <img th:src="'https://image.tmdb.org/t/p/w500' + ${tmdbMovie.poster_path}" alt="Movie Poster" style="max-width: 200px;">
        <h3 th:text="${tmdbMovie.title}"></h3>
        <p th:text="${tmdbMovie.overview}"></p>
        <div>
            <strong>Genres:</strong>
            <ul>
                <li th:each="genre : ${movieGenre}" th:text="${genre}"></li>
            </ul>
        </div>
        <p>
            <a th:href="'https://www.themoviedb.org/movie/' + ${tmdbMovie.id}" target="_blank">View on TMDB</a>
        </p>

        <div th:if="${LoggedInUser != null}">
            <form th:action="@{/addMovieToWatched}" method="post">
                <input type="hidden" name="userId" th:value="${LoggedInUser.id}"/>
                <input type="hidden" name="movieTitle" th:value="${tmdbMovie.title}"/>
                <input type="hidden" name="movieGenreIds" th:value="${tmdbMovie.genre_ids}"/>
                <input type="hidden" name="movieOverview" th:value="${tmdbMovie.overview}"/>
                <input type="hidden" name="movieReleaseDate" th:value="${tmdbMovie.release_date}"/>
                <button type="submit">Add to watch history</button>
            </form>

            <!-- Add to Movie List -->
            <form th:action="@{/addMovieToList}" method="post">
                <input type="hidden" name="userId" th:value="${tmdbMovie.id}"/>
                <input type="hidden" name="movieTitle" th:value="${tmdbMovie.title}"/>
                <input type="hidden" name="movieGenreIds" th:value="${tmdbMovie.genre_ids}"/>
                <input type="hidden" name="movieOverview" th:value="${tmdbMovie.overview}"/>
                <input type="hidden" name="movieReleaseDate" th:value="${tmdbMovie.release_date}"/>
                <label for="movieListId">Add to List:</label>
                <select name="movieListId" id="movieListId">
                    <option th:each="list : ${movieLists}" th:value="${list.id}" th:text="${list.name}"></option>
                </select>
                <button type="submit">Add to List</button>
            </form>
            <!-- Add to Watched  -->
            <form th:action="@{/addMovieToWatched}" method="post">
                <input type="hidden" name="userId" th:value="${LoggedInUser.id}"/>
                <input type="hidden" name="movieTitle" th:value="${tmdbMovie.title}"/>
                <input type="hidden" name="movieGenreIds" th:value="${tmdbMovie.genre_ids}"/>
                <input type="hidden" name="movieOverview" th:value="${tmdbMovie.overview}"/>
                <input type="hidden" name="movieReleaseDate" th:value="${tmdbMovie.release_date}"/>

                <button type="submit">Add to watch history</button>
            </form>
        </div>
    </div>
    <div th:if="${tmdbMovie == null}">
        <p>No featured movie available at the moment.</p>
    </div>
</section>

<hr/>

<!-- Movie Search Form -->
<section>
    <h2>Find a Movie</h2>
    <form th:action="@{/}" method="post">
        <!-- Genre Selection -->
        <fieldset>
            <legend>Select Genres</legend>
            <div th:each="genre : ${genres}">
                <label>
                    <input type="checkbox" name="genres" th:value="${genre}" th:id="${genre}" th:checked="${selectedGenres != null and selectedGenres.contains(genre)}"/>
                    <span th:text="${genre.name()}"></span>
                </label>
            </div>
        </fieldset>

        <!-- Optional Filters -->
        <fieldset>
            <legend>Optional Filters</legend>
            <label for="minRating">Minimum IMDb Rating:</label>
            <input type="number" step="0.1" min="0" max="10" name="minRating" id="minRating"><br/>

            <label for="minVotes">Minimum Votes:</label>
            <input type="number" min="0" name="minVotes" id="minVotes"><br/>

            <label for="certification">Age Rating (e.g., PG-13):</label>
            <input type="text" name="certification" id="certification"><br/>

            <label for="minRuntime">Minimum Length (minutes):</label>
            <input type="number" min="0" name="minRuntime" id="minRuntime"><br/>

            <label for="maxRuntime">Maximum Length (minutes):</label>
            <input type="number" min="0" name="maxRuntime" id="maxRuntime"><br/>
        </fieldset>

        <!-- Child-Safe Mode -->
        <label for="child_safe">Child-Safe Mode:</label>
        <input type="checkbox" name="child_safe" id="child_safe" th:checked="${child_safe}"><br/>

        <!-- Action Buttons -->
        <div>
            <button type="submit" name="action" value="Random Movie">Random Movie</button>
            <button type="submit" name="action" value="Movie based on selected genres">Movie Based on Selected Genres</button>
            <div th:if="${LoggedInUser != null}">
                <button type="submit" name="action" value="Movie based on saved genres">Movie Based on Saved Genres</button>
				<button type="submit" name="action" value="Movies based on saved genres">Movies based on saved Genres</button>
            </div>


        </div>
    </form>
</section>

<hr/>

<!-- Sentence-Based Movie Search -->
<section>
    <h2>Describe the Movie You Want</h2>
    <form th:action="@{/api/movies/recommend}" method="get">
        <label for="query">Describe the type of movie you want:</label><br/>
        <input
                type="text"
                id="query"
                name="query"
                th:placeholder="${query == null ? 'e.g., a thrilling sci-fi movie about space exploration' : query}"
                required>
        <button type="submit">Search</button>
    </form>
</section>

<!-- Search Results -->
<!--<section th:if="${query != null}">
    <h2>Results for: <span th:text="${query}"></span></h2>
    <div th:if="${recommendedMovies != null}">
        <div th:if="${recommendedMovies.isEmpty()}">
            <p>No movies found for your search query.</p>
        </div>
        <div th:if="${!recommendedMovies.isEmpty()}">
            <h3>Recommended Movies</h3>
            <div th:each="movie : ${recommendedMovies}">
                <img th:src="'https://image.tmdb.org/t/p/w500' + ${movie.poster_path}" alt="Movie Poster" style="max-width: 200px;">
                <h4 th:text="${movie.title}"></h4>
                <p th:text="${movie.overview}"></p>
                <p>
                    <a th:href="'https://www.themoviedb.org/movie/' + ${movie.id}" target="_blank">View on TMDB</a>
                </p>
                <hr/>
            </div>
        </div>
    </div>
</section>-->
<!-- Suggestions -->
<section th:if="${recommendedMovies != null}">
    <h2 th:if="${query != null}">Results for: <span th:text="${query}"></span></h2>
    <div th:if="${recommendedMovies.isEmpty()}">
        <p>No movies found for your search query.</p>
    </div>
    <div th:if="${!recommendedMovies.isEmpty()}">
        <h3>Recommended Movies</h3>
        <div th:each="movie : ${recommendedMovies}">
            <img th:src="'https://image.tmdb.org/t/p/w500' + ${movie.poster_path}" alt="Movie Poster" style="max-width: 200px;">
            <h4 th:text="${movie.title}"></h4>
            <p th:text="${movie.overview}"></p>
            <p>
                <a th:href="'https://www.themoviedb.org/movie/' + ${movie.id}" target="_blank">View on TMDB</a>
            </p>
            <hr/>
        </div>
    </div>
</section>

</body>
</html>
