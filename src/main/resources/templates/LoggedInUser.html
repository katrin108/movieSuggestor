<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Your Profile</title>
</head>
<body>

<!-- Header -->
<h1>Welcome, <span th:text="${LoggedInUser.username}"></span>!</h1>

<!-- User Information -->
<section>
    <h2>Your Profile Information</h2>
    <p>Email: <span th:text="${LoggedInUser.email ?: 'Not provided'}"></span></p>
    <p>Child-safe mode: <span th:text="${LoggedInUser.child ? 'On' : 'Off'}"></span></p>
    <h3>Your Preferences:</h3>
    <ul>
        <li th:each="genre : ${LoggedInUser.genres}">
            <span th:text="${genre}"></span>
        </li>
        <li th:if="${LoggedInUser.genres.size() == 0}">No preferences set.</li>
    </ul>
    <p><a href="/loggedin/preferences">Update Preferences</a></p>
</section>

<!-- Navigation Buttons -->
<nav>
    <form th:action="@{/}" method="get" style="display:inline;">
        <button type="submit">Home Page</button>
    </form>
    <form th:action="@{/logout}" method="post" style="display:inline;">
        <button type="submit">Log Out</button>
    </form>
    <form th:action="@{/toggleSettings}" method="post" style="display:inline;">
        <button type="submit">Settings</button>
    </form>
</nav>

<!-- User Settings -->
<div th:if="${DivSettings}" id="userSettings">
    <h2>User Settings</h2>
    <form th:action="@{/saveSettings}" method="post">
        <label for="username">Username:
            <input type="text" name="username" id="username" th:value="${LoggedInUser.username}">
        </label><br/>
        <label for="password">Password:
            <input type="password" name="password" id="password" th:value="${LoggedInUser.password}">
        </label><br/>
        <label for="email">Email:
            <input type="email" name="email" id="email" th:value="${LoggedInUser.email}">
        </label><br/>
        <label for="child_safe">Child-safe mode:
            <input type="checkbox" name="child" id="child_safe" th:checked="${LoggedInUser.child}">
        </label><br/>
        <button type="submit">Save Changes</button>
    </form>
    <form th:action="@{/deleteUser}" method="post" onsubmit="return confirm('Are you sure you want to delete your account?');">
        <button type="submit">Delete Account</button>
    </form>
</div>

<!-- Movie Lists -->
<section>
    <h2>Your Movie Lists</h2>
    <form th:action="@{/addMovieList}" method="post">
        <label for="name">Create New Movie List:</label>
        <input type="text" id="name" name="name" required />
        <button type="submit">Add Movie List</button>
    </form>

    <div th:if="${movieLists.size() == 0}">
        <p>You have no movie lists yet.</p>
    </div>

    <div th:if="${movieLists.size() > 0}">
        <ul>
            <li th:each="movieList : ${movieLists}">
                <h3 th:text="${movieList.name}"></h3>
                <form th:action="@{/deleteMovieList}" method="post" style="display:inline;">
                    <input type="hidden" name="movieListId" th:value="${movieList.id}"/>
                    <button type="submit">Delete List</button>
                </form>
                <div th:if="${movieList.movies != null}">
                    <p th:if="${movieList.movies.size() == 0}">No movies in this list.</p>
                    <table th:if="${movieList.movies.size() > 0}" border="1">
                        <thead>
                        <tr>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Release Date</th>
                            <th>Actions</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="movie : ${movieList.movies}">
                            <td th:text="${movie.title}"></td>
                            <td th:text="${movie.description}"></td>
                            <td th:text="${movie.releaseDate}"></td>
                            <td>
                                <!-- You can add actions like delete or view details -->
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </li>
        </ul>
    </div>
</section>

<!-- Movie Recommendation -->
<section>
    <h2>Get a Movie Recommendation</h2>
    <form th:action="@{/getSuggestedMovie}" method="post">
        <!-- Optional Filters -->
        <fieldset>
            <legend>Optional Filters</legend>

            <label for="minRating">Minimum IMDb Rating:</label>
            <input type="number" step="0.1" min="0" max="10" name="minRating" id="minRating"><br/>

            <label for="minVotes">Minimum Votes:</label>
            <input type="number" min="0" name="minVotes" id="minVotes"><br/>

            <label for="certification">Age Rating (e.g., PG-13):</label>
            <input type="text" name="certification" id="certification"><br/>

            <label for="minRuntime">Minimum Length (minutes):</label>
            <input type="number" min="0" name="minRuntime" id="minRuntime"><br/>

            <label for="maxRuntime">Maximum Length (minutes):</label>
            <input type="number" min="0" name="maxRuntime" id="maxRuntime"><br/>
        </fieldset>

        <!-- Child-Safe Mode -->
        <label for="child_safe">Child-Safe Mode:</label>
        <input type="checkbox" name="child_safe" id="child_safe" th:checked="${LoggedInUser.child}"><br/>

        <button type="submit" th:text="${(hasSuggestedMovie ?: false) ? 'Reroll Suggested Movie' : 'Get Suggested Movie'}"></button>
    </form>

    <!-- Display Recommended Movie -->
    <div th:if="${hasSuggestedMovie ?: false}">
        <h3>Recommended Movie</h3>
        <div th:if="${recommendedMovie != null}">
            <h4 th:text="${recommendedMovie.title}"></h4>
            <p th:text="${recommendedMovie.overview}"></p>
            <img th:if="${recommendedMovie.poster_path != null}" th:src="'https://image.tmdb.org/t/p/w200' + ${recommendedMovie.poster_path}" alt="Movie Poster">
            <p><strong>Release Date:</strong> <span th:text="${recommendedMovie.release_date}"></span></p>
            <p><strong>Genres:</strong>
                <span th:each="genre : ${movieGenre}" th:text="${genre} + ' '"></span>
            </p>
            <!-- Add to Movie List -->
            <form th:action="@{/addMovieToList}" method="post">
                <input type="hidden" name="movieId" th:value="${recommendedMovie.id}"/>
                <input type="hidden" name="movieTitle" th:value="${recommendedMovie.title}"/>
                <input type="hidden" name="movieGenreIds" th:value="${recommendedMovie.genre_ids}"/>
                <input type="hidden" name="movieOverview" th:value="${recommendedMovie.overview}"/>
                <input type="hidden" name="movieReleaseDate" th:value="${recommendedMovie.release_date}"/>
                <label for="movieListId">Add to List:</label>
                <select name="movieListId" id="movieListId">
                    <option th:each="list : ${movieLists}" th:value="${list.id}" th:text="${list.name}"></option>
                </select>
                <button type="submit">Add to List</button>
            </form>
        </div>
        <div th:if="${recommendedMovie == null}">
            <p th:text="${errorMessage}"></p>
        </div>
    </div>
</section>

</body>
</html>
